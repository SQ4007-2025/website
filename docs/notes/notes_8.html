<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>notes_8 – Computing Technology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2b3e328b71be8d25427581baeb23079b.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-595e7a736fcf46aa1895a448280c433c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-e9f3ba5fbee03b112b18b9666ab66a2c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-595e7a736fcf46aa1895a448280c433c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Computing Technology">
<meta property="og:image" content="https://SQ4007-2025.github.io/website/notes/images/week_7/Week7Slide025.png">
<meta property="og:site_name" content="Computing Technology">
<meta property="og:image:height" content="540">
<meta property="og:image:width" content="960">
<meta name="twitter:title" content="Computing Technology">
<meta name="twitter:image" content="https://SQ4007-2025.github.io/website/notes/images/twitter-card.png">
<meta name="twitter:creator" content="@EdHarris9000">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/weharris" title="Course GitHub repo" class="quarto-navigation-tool px-1" aria-label="Course GitHub repo"><i class="bi bi-github"></i></a>
    <a href="https://youtube.com/@TheStatisticsLab" title="YouTube" class="quarto-navigation-tool px-1" aria-label="YouTube"><i class="bi bi-youtube"></i></a>
    <a href="https://discord.gg/dnNTE6xhhu" title="Join our Discord" class="quarto-navigation-tool px-1" aria-label="Join our Discord"><i class="bi bi-discord"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module-schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module-syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module-links.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Useful links</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module-faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lecture-8-notes" id="toc-lecture-8-notes" class="nav-link active" data-scroll-target="#lecture-8-notes">Lecture 8 Notes</a>
  <ul class="collapse">
  <li><a href="#welcome" id="toc-welcome" class="nav-link" data-scroll-target="#welcome">Welcome!</a></li>
  <li><a href="#flat-file-database" id="toc-flat-file-database" class="nav-link" data-scroll-target="#flat-file-database">Flat-File Database</a></li>
  <li><a href="#relational-databases" id="toc-relational-databases" class="nav-link" data-scroll-target="#relational-databases">Relational Databases</a></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select">SELECT</a></li>
  <li><a href="#insert" id="toc-insert" class="nav-link" data-scroll-target="#insert">INSERT</a></li>
  <li><a href="#delete" id="toc-delete" class="nav-link" data-scroll-target="#delete">DELETE</a></li>
  <li><a href="#update" id="toc-update" class="nav-link" data-scroll-target="#update">UPDATE</a></li>
  <li><a href="#imdb" id="toc-imdb" class="nav-link" data-scroll-target="#imdb">IMDb</a></li>
  <li><a href="#joins" id="toc-joins" class="nav-link" data-scroll-target="#joins"><code>JOIN</code>s</a></li>
  <li><a href="#indexes" id="toc-indexes" class="nav-link" data-scroll-target="#indexes">Indexes</a></li>
  <li><a href="#using-sql-in-python" id="toc-using-sql-in-python" class="nav-link" data-scroll-target="#using-sql-in-python">Using SQL in Python</a></li>
  <li><a href="#race-conditions" id="toc-race-conditions" class="nav-link" data-scroll-target="#race-conditions">Race Conditions</a></li>
  <li><a href="#sql-injection-attacks" id="toc-sql-injection-attacks" class="nav-link" data-scroll-target="#sql-injection-attacks">SQL Injection Attacks</a></li>
  <li><a href="#summing-up" id="toc-summing-up" class="nav-link" data-scroll-target="#summing-up">Summing Up</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/SQ4007-2025/website/edit/main/notes/notes_8.md" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/SQ4007-2025/website/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>





<section id="lecture-8-notes" class="level1">
<h1>Lecture 8 Notes</h1>
<ul>
<li><a href="#welcome">Welcome!</a></li>
<li><a href="#flat-file-database">Flat-File Database</a></li>
<li><a href="#relational-databases">Relational Databases</a></li>
<li><a href="#select">SELECT</a></li>
<li><a href="#insert">INSERT</a></li>
<li><a href="#delete">DELETE</a></li>
<li><a href="#update">UPDATE</a></li>
<li><a href="#imdb">IMDb</a></li>
<li><a href="#joins"><code>JOIN</code>s</a></li>
<li><a href="#indexes">Indexes</a></li>
<li><a href="#using-sql-in-python">Using SQL in Python</a></li>
<li><a href="#race-conditions">Race Conditions</a></li>
<li><a href="#sql-injection-attacks">SQL Injection Attacks</a></li>
<li><a href="#summing-up">Summing Up</a></li>
</ul>
<section id="welcome" class="level2">
<h2 class="anchored" data-anchor-id="welcome">Welcome!</h2>
<ul>
<li>In previous weeks, we introduced you to Python, a high-level programming language that utilized the same building blocks we learned in C. However, we introduced this new language not for the purpose of learning “just another language.” Instead, we do so because some tools are better for some jobs and not so great for others!</li>
<li>This week, we will be continuing more syntax related to Python.</li>
<li>Further, we will be integrating this knowledge with data.</li>
<li>Finally, we will be discussing <em>SQL</em> or <em>Structured Query Language</em>, a domain-specific way by which we can interact with and modify data.</li>
<li>Overall, one of the goals of this course is to learn to program generally – not simply how to program in the languages described in this course.</li>
</ul>
</section>
<section id="flat-file-database" class="level2">
<h2 class="anchored" data-anchor-id="flat-file-database">Flat-File Database</h2>
<ul>
<li><p>As you have likely seen before, data can often be described in patterns of columns and rows.</p></li>
<li><p>Spreadsheets like those created in Microsoft Excel and Google Sheets can be outputted to a <code>csv</code> or <em>comma-separated values</em> file.</p></li>
<li><p>If you look at a <code>csv</code> file, you’ll notice that the file is flat in that all of our data is stored in a single table represented by a text file. We call this form of data a <em>flat-file database</em>.</p></li>
<li><p>All data is stored row by row. Each column is separated by a comma or another value.</p></li>
<li><p>Python comes with native support for <code>csv</code> files.</p></li>
<li><p>First, download <a href="https://cdn.cs50.net/2023/fall/lectures/7/src7/favorites/favorites.csv">favorites.csv</a> and upload it to your file explorer inside <a href="https://cs50.dev">cs50.dev</a>. Second, examining this data, notice that the first row is special in that it defines each column. Then, each record is stored row by row.</p></li>
<li><p>In your terminal window, type <code>code favorites.py</code> and write code as follows:</p>
<pre><code># Prints all favorites in CSV using csv.reader

import csv

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create reader
    reader = csv.reader(file)

    # Skip header row
    next(reader)

    # Iterate over CSV file, printing each favorite
    for row in reader:
        print(row[1])
</code></pre>
<p>Notice that the <code>csv</code> library is imported. Further, we created a <code>reader</code> that will hold the result of <code>csv.reader(file)</code>. The <code>csv.reader</code> function reads each row from the file, and in our code, we store the results in <code>reader</code>. <code>print(row[1])</code>, therefore, will print the language from the <code>favorites.csv</code> file.</p></li>
<li><p>You can improve your code as follows:</p>
<pre><code># Stores favorite in a variable

import csv

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create reader
    reader = csv.reader(file)

    # Skip header row
    next(reader)

    # Iterate over CSV file, printing each favorite
    for row in reader:
        favorite = row[1]
        print(favorite)
</code></pre>
<p>Notice that <code>favorite</code> is stored and then printed. Also, notice that we use the <code>next</code> function to skip to the next line of our reader.</p></li>
<li><p>One of the disadvantages of the above approach is that we are trusting that <code>row[1]</code> is always the favorite. However, what would happen if the columns had been moved around?</p></li>
<li><p>We can fix this potential issue. Python also allows you to index by the keys of a list. Modify your code as follows:</p>
<pre><code># Prints all favorites in CSV using csv.DictReader

import csv

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create DictReader
    reader = csv.DictReader(file)

    # Iterate over CSV file, printing each favorite
    for row in reader:
        favorite = row["language"]
        print(favorite)
</code></pre>
<p>Notice that this example directly utilizes the <code>language</code> key in the print statement. <code>favorite</code> indexes into the <code>reader</code> dictionary of <code>row["language"]</code>.</p></li>
<li><p>This could be further simplified to:</p>
<pre><code># Prints all favorites in CSV using csv.DictReader

import csv

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create DictReader
    reader = csv.DictReader(file)

    # Iterate over CSV file, printing each favorite
    for row in reader:
        print(row["language"])
</code></pre></li>
<li><p>To count the number of favorite languages expressed in the <code>csv</code> file, we can do the following:</p>
<pre><code># Counts favorites using variables

import csv

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create DictReader
    reader = csv.DictReader(file)

    # Counts
    scratch, c, python = 0, 0, 0

    # Iterate over CSV file, counting favorites
    for row in reader:
        favorite = row["language"]
        if favorite == "Scratch":
            scratch += 1
        elif favorite == "C":
            c += 1
        elif favorite == "Python":
            python += 1

# Print counts
print(f"Scratch: {scratch}")
print(f"C: {c}")
print(f"Python: {python}")
</code></pre>
<p>Notice that each language is counted using <code>if</code> statements. Further, notice the double equal <code>==</code> signs in those <code>if</code> statements.</p></li>
<li><p>Python allows us to use a dictionary to count the <code>counts</code> of each language. Consider the following improvement upon our code:</p>
<pre><code># Counts favorites using dictionary

import csv

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create DictReader
    reader = csv.DictReader(file)

    # Counts
    counts = {}

    # Iterate over CSV file, counting favorites
    for row in reader:
        favorite = row["language"]
        if favorite in counts:
            counts[favorite] += 1
        else:
            counts[favorite] = 1

# Print counts
for favorite in counts:
    print(f"{favorite}: {counts[favorite]}")
</code></pre>
<p>Notice that the value in <code>counts</code> with the key <code>favorite</code> is incremented when it exists already. If it does not exist, we define <code>counts[favorite]</code> and set it to 1. Further, the formatted string has been improved to present the <code>counts[favorite]</code>.</p></li>
<li><p>Python also allows sorting <code>counts</code>. Improve your code as follows:</p>
<pre><code># Sorts favorites by key

import csv

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create DictReader
    reader = csv.DictReader(file)

    # Counts
    counts = {}

    # Iterate over CSV file, counting favorites
    for row in reader:
        favorite = row["language"]
        if favorite in counts:
            counts[favorite] += 1
        else:
            counts[favorite] = 1

# Print counts
for favorite in sorted(counts):
    print(f"{favorite}: {counts[favorite]}")
</code></pre>
<p>Notice the <code>sorted(counts)</code> at the bottom of the code.</p></li>
<li><p>If you look at the parameters for the <code>sorted</code> function in the Python documentation, you will find it has many built-in parameters. You can leverage some of these built-in parameters as follows:</p>
<pre><code># Sorts favorites by value using .get

import csv

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create DictReader
    reader = csv.DictReader(file)

    # Counts
    counts = {}

    # Iterate over CSV file, counting favorites
    for row in reader:
        favorite = row["language"]
        if favorite in counts:
            counts[favorite] += 1
        else:
            counts[favorite] = 1

# Print counts
for favorite in sorted(counts, key=counts.get, reverse=True):
    print(f"{favorite}: {counts[favorite]}")
</code></pre>
<p>Notice the arguments passed to <code>sorted</code>. The <code>key</code> argument allows you to tell Python the method you wish to use to sort items. In this case <code>counts.get</code> is used to sort by the values. <code>reverse=True</code> tells <code>sorted</code> to sort from largest to smallest.</p></li>
<li><p>Python has numerous libraries that we can utilize in our code. One of these libraries is <code>collections</code>, from which we can import <code>Counter</code>. <code>Counter</code> will allow you to access the counts of each language without the headaches of all the <code>if</code> statements seen in our previous code. You can implement as follows:</p>
<pre><code># Sorts favorites by value using .get

import csv

from collections import Counter

# Open CSV file
with open("favorites.csv", "r") as file:

    # Create DictReader
    reader = csv.DictReader(file)

    # Counts
    counts = Counter()

    # Iterate over CSV file, counting favorites
    for row in reader:
        favorite = row["language"]
        counts[favorite] += 1

# Print counts
for favorite, count in counts.most_common():
    print(f"{favorite}: {count}")
</code></pre>
<p>Notice how <code>counts = Counter()</code> enables the use of this imported <code>Counter</code> class from <code>collections</code>.</p></li>
<li><p>You can learn more about <a href="https://docs.python.org/3/howto/sorting.html">sorted</a> in the <a href="https://docs.python.org/3/howto/sorting.html">Python Documentation</a>.</p></li>
</ul>
</section>
<section id="relational-databases" class="level2">
<h2 class="anchored" data-anchor-id="relational-databases">Relational Databases</h2>
<ul>
<li><p>Google, X, and Meta all use relational databases to store their information at scale.</p></li>
<li><p>Relational databases store data in rows and columns in structures called <em>tables</em>.</p></li>
<li><p>SQL allows for four types of commands:</p>
<pre><code>  Create
  Read
  Update
  Delete
</code></pre></li>
<li><p>These four operations are affectionately called <em>CRUD</em>.</p></li>
<li><p>We can create a database with the SQL syntax <code>CREATE TABLE table (column type, ...);</code>. But where do you run this command?</p></li>
<li><p><code>sqlite3</code> is a type of SQL database that has the core features required for this course.</p></li>
<li><p>We can create a SQL database at the terminal by typing <code>sqlite3 favorites.db</code>. Upon being prompted, we will agree that we want to create <code>favorites.db</code> by pressing <code>y</code>.</p></li>
<li><p>You will notice a different prompt as we are now using a program called <code>sqlite</code>.</p></li>
<li><p>We can put <code>sqlite</code> into <code>csv</code> mode by typing <code>.mode csv</code>. Then, we can import our data from our <code>csv</code> file by typing <code>.import favorites.csv favorites</code>. It seems that nothing has happened!</p></li>
<li><p>We can type <code>.schema</code> to see the structure of the database.</p></li>
<li><p>You can read items from a table using the syntax <code>SELECT columns FROM table</code>.</p></li>
<li><p>For example, you can type <code>SELECT * FROM favorites;</code> which will print every row in <code>favorites</code>.</p></li>
<li><p>You can get a subset of the data using the command <code>SELECT language FROM favorites;</code>.</p></li>
<li><p>SQL supports many commands to access data, including:</p>
<pre><code>  AVG
  COUNT
  DISTINCT
  LOWER
  MAX
  MIN
  UPPER
</code></pre></li>
<li><p>For example, you can type <code>SELECT COUNT(*) FROM favorites;</code>. Further, you can type <code>SELECT DISTINCT language FROM favorites;</code> to get a list of the individual languages within the database. You could even type <code>SELECT COUNT(DISTINCT language) FROM favorites;</code> to get a count of those.</p></li>
<li><p>SQL offers additional commands we can utilize in our queries:</p>
<pre><code>  WHERE       -- adding a Boolean expression to filter our data
  LIKE        -- filtering responses more loosely
  ORDER BY    -- ordering responses
  LIMIT       -- limiting the number of responses
  GROUP BY    -- grouping responses together
</code></pre>
<p>Notice that we use <code>--</code> to write a comment in SQL.</p></li>
</ul>
</section>
<section id="select" class="level2">
<h2 class="anchored" data-anchor-id="select">SELECT</h2>
<ul>
<li>For example, we can execute <code>SELECT COUNT(*) FROM favorites WHERE language = 'C';</code>. A count is presented.</li>
<li>Further, we could type <code>SELECT COUNT(*) FROM favorites WHERE language = 'C' AND problem = 'Hello, World';</code>. Notice how the <code>AND</code> is utilized to narrow our results.</li>
<li>Similarly, we could execute <code>SELECT language, COUNT(*) FROM favorites GROUP BY language;</code>. This would offer a temporary table that would show the language and count.</li>
<li>We could improve this by typing <code>SELECT language, COUNT(*) FROM favorites GROUP BY language ORDER BY COUNT(*);</code>. This will order the resulting table by the <code>count</code>.</li>
<li>Likewise, we could execute <code>SELECT COUNT(*) FROM favorites WHERE language = 'C' AND (problem = 'Hello, World' OR problem = 'Hello, It''s Me');</code>. Do notice that there are two <code>''</code> marks as to allow the use of single quotes in a way that does not confuse SQL.</li>
<li>Further, we could execute <code>SELECT COUNT(*) FROM favorites WHERE language = 'C' AND problem LIKE 'Hello, %';</code> to find any problems that start with <code>Hello,</code> (including a space).</li>
<li>We can also group the values of each language by executing <code>SELECT language, COUNT(*) FROM favorites GROUP BY language;</code>.</li>
<li>We can order the output as follows: <code>SELECT language, COUNT(*) FROM favorites GROUP BY language ORDER BY COUNT(*) DESC;</code>.</li>
<li>We can even create aliases, like variables in our queries: <code>SELECT language, COUNT(*) AS n FROM favorites GROUP BY language ORDER BY n DESC;</code>.</li>
<li>Finally, we can limit our output to 1 or more values: <code>SELECT language, COUNT(*) AS n FROM favorites GROUP BY language ORDER BY n DESC LIMIT 1;</code>.</li>
</ul>
</section>
<section id="insert" class="level2">
<h2 class="anchored" data-anchor-id="insert">INSERT</h2>
<ul>
<li>We can also <code>INSERT</code> into a SQL database utilizing the form <code>INSERT INTO table (column...) VALUES(value, ...);</code>.</li>
<li>We can execute <code>INSERT INTO favorites (language, problem) VALUES ('SQL', 'Fiftyville');</code>.</li>
<li>You can verify the addition of this favorite by executing <code>SELECT * FROM favorites;</code>.</li>
</ul>
</section>
<section id="delete" class="level2">
<h2 class="anchored" data-anchor-id="delete">DELETE</h2>
<ul>
<li><code>DELETE</code> allows you to delete parts of your data. For example, you could <code>DELETE FROM favorites WHERE Timestamp IS NULL;</code>. This deletes any record where the <code>Timestamp</code> is <code>NULL</code>.</li>
</ul>
</section>
<section id="update" class="level2">
<h2 class="anchored" data-anchor-id="update">UPDATE</h2>
<ul>
<li>We can also utilize the <code>UPDATE</code> command to update your data.</li>
<li>For example, you can execute <code>UPDATE favorites SET language = 'SQL', problem = 'Fiftyville';</code>. This will result in overwriting all previous statements where C and Scratch were the favorite programming language.</li>
<li>Notice that these queries have immense power. Accordingly, in the real-world setting, you should consider who has permissions to execute certain commands and if you have backups available!</li>
</ul>
</section>
<section id="imdb" class="level2">
<h2 class="anchored" data-anchor-id="imdb">IMDb</h2>
<ul>
<li><p>We can imagine a database that we might want to create to catalog various TV shows. We could create a spreadsheet with columns like <code>title</code>, <code>star</code>, <code>star</code>, <code>star</code>, <code>star</code>, and more stars. A problem with this approach is that it has a lot of wasted space. Some shows may have one star. Others may have dozens.</p></li>
<li><p>We could separate our database into multiple sheets. We could have a <code>shows</code> sheet, a <code>stars</code> sheet, and a <code>people</code> sheet. On the <code>people</code> sheet, each person could have a unique <code>id</code>. On the <code>shows</code> sheet, each show could have a unique <code>id</code> too. On a third sheet called <code>stars</code> we could relate how each show has people for each show by having a <code>show_id</code> and <code>person_id</code>. While this is an improvement, this is not an ideal database.</p></li>
<li><p>IMDb offers a database of people, shows, writers, stars, genres, and ratings. Each of these tables is related to one another as follows:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/week_7/Week7Slide025.png" class="img-fluid figure-img"></p>
<figcaption>six boxes that represent various sql tables arrows are drawn to each showing their many relationships with one another</figcaption>
</figure>
</div></li>
<li><p>After downloading <a href="https://cdn.cs50.net/2024/fall/lectures/7/src7/imdb/shows.db"><code>shows.db</code></a>, you can execute <code>sqlite3 shows.db</code> in your terminal window.</p></li>
<li><p>Let’s zero in on the relationship between two tables within the database called <code>shows</code> and <code>ratings</code>. The relationship between these two tables can be illustrated as follows:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/week_7/Week7Slide032.png" class="img-fluid figure-img"></p>
<figcaption>two boxes one called shows and the other called ratings</figcaption>
</figure>
</div></li>
<li><p>To illustrate the relationship between these tables, we could execute the following command: <code>SELECT * FROM ratings LIMIT 10;</code>. Examining the output, we could execute <code>SELECT * FROM shows LIMIT 10;</code>.</p></li>
<li><p>Examining <code>shows</code> and <code>rating</code>, we can see these have a one-to-one relationship: One show has one rating.</p></li>
<li><p>To understand the database, upon executing <code>.schema</code> you will find not only each of the tables but the individual fields inside each of these fields.</p></li>
<li><p>More specifically, you could execute <code>.schema shows</code> to understand the fields inside <code>shows</code>. You can also execute <code>.schema ratings</code> to see the fields inside <code>ratings</code>.</p></li>
<li><p>As you can see, <code>show_id</code> exists in all of the tables. In the <code>shows</code> table, it is simply called <code>id</code>. This common field between all the fields is called a <em>key</em>. Primary keys are used to identify a unique record in a table. <em>Foreign keys</em> are used to build relationships between tables by pointing to the primary key in another table. You can see in the schema of <code>ratings</code> that <code>show_id</code> is a foreign key that references <code>id</code> in <code>shows</code>.</p></li>
<li><p>By storing data in a relational database, as above, data can be more efficiently stored.</p></li>
<li><p>In <em>sqlite</em>, we have five data types, including:</p>
<pre><code>  BLOB       -- binary large objects that are groups of ones and zeros
  INTEGER    -- an integer
  NUMERIC    -- for numbers that are formatted specially like dates
  REAL       -- like a float
  TEXT       -- for strings and the like
</code></pre></li>
<li><p>Additionally, columns can be set to add special constraints:</p>
<pre><code>  NOT NULL
  UNIQUE
</code></pre></li>
<li><p>We can further play with this data to understand these relationships. Execute <code>SELECT * FROM ratings;</code>. There are a lot of ratings!</p></li>
<li><p>We can further limit this data down by executing <code>SELECT show_id FROM ratings WHERE rating &gt;= 6.0 LIMIT 10;</code>. From this query, you can see that there are 10 shows presented. However, we don’t know what show each <code>show_id</code> represents.</p></li>
<li><p>You can discover what shows these are by executing <code>SELECT * FROM shows WHERE id = 626124;</code></p></li>
<li><p>We can further our query to be more efficient by executing:</p>
<pre><code>SELECT title
FROM shows
WHERE id IN (
    SELECT show_id
    FROM ratings
    WHERE rating &gt;= 6.0
    LIMIT 10
)
</code></pre>
<p>Notice that this query nests together two queries. An inner query is used by an outer query.</p></li>
</ul>
</section>
<section id="joins" class="level2">
<h2 class="anchored" data-anchor-id="joins"><code>JOIN</code>s</h2>
<ul>
<li><p>We are pulling data from <code>shows</code> and <code>ratings</code>. Notice how both <code>shows</code> and <code>ratings</code> have an <code>id</code> in common.</p></li>
<li><p>How could we combine tables temporarily? Tables could be joined together using the <code>JOIN</code> command.</p></li>
<li><p>Execute the following command:</p>
<pre><code>SELECT * FROM shows
  JOIN ratings on shows.id = ratings.show_id
  WHERE rating &gt;= 6.0
  LIMIT 10;
</code></pre>
<p>Notice this results in a wider table than we have previously seen.</p></li>
<li><p>Where the previous queries have illustrated the <em>one-to-one</em> relationship between these keys, let’s examine some <em>one-to-many</em> relationships. Focusing on the <code>genres</code> table, execute the following:</p>
<pre><code>SELECT * FROM genres
LIMIT 10;
</code></pre>
<p>Notice how this provides us a sense of the raw data. You might notice that one show has three values. This is a one-to-many relationship.</p></li>
<li><p>We can learn more about the <code>genres</code> table by typing <code>.schema genres</code>.</p></li>
<li><p>Execute the following command to learn more about the various comedies in the database:</p>
<pre><code>SELECT title FROM shows
WHERE id IN (
  SELECT show_id FROM genres
  WHERE genre = 'Comedy'
  LIMIT 10
);
</code></pre>
<p>Notice how this produces a list of comedies, including <em>Catweazle</em>.</p></li>
<li><p>To learn more about Catweazle, by joining various tables through a join:</p>
<pre><code>SELECT * FROM shows
JOIN genres
ON shows.id = genres.show_id
WHERE id = 63881;
</code></pre>
<p>Notice that this results in a temporary table. It is fine to have a duplicate table.</p></li>
<li><p>In contrast to one-to-one and one-to-many relationships, there may be <em>many-to-many</em> relationships.</p></li>
<li><p>We can learn more about the show <em>The Office</em> and the actors in that show by executing the following command:</p>
<pre><code>SELECT name FROM people WHERE id IN 
    (SELECT person_id FROM stars WHERE show_id = 
        (SELECT id FROM shows WHERE title = 'The Office' AND year = 2005));
</code></pre>
<p>Notice that this results in a table that includes the names of various stars through nested queries.</p></li>
<li><p>We find all the shows in which Steve Carell starred:</p>
<pre><code>SELECT title FROM shows WHERE id IN 
    (SELECT show_id FROM stars WHERE person_id = 
        (SELECT id FROM people WHERE name = 'Steve Carell'));
</code></pre>
<p>This results in a list of titles of shows wherein Steve Carell starred.</p></li>
<li><p>This could also be expressed in this way:</p>
<pre><code>SELECT title FROM shows, stars, people 
WHERE shows.id = stars.show_id
AND people.id = stars.person_id
AND name = 'Steve Carell';
</code></pre></li>
<li><p>The wildcard <code>%</code> operator can be used to find all people whose names start with <code>Steve C</code> one could employ the syntax <code>SELECT * FROM people WHERE name LIKE 'Steve C%';</code>.</p></li>
</ul>
</section>
<section id="indexes" class="level2">
<h2 class="anchored" data-anchor-id="indexes">Indexes</h2>
<ul>
<li><p>While relational databases have the ability to be faster and more robust than utilizing a <code>CSV</code> file, data can be optimized within a table using <em>indexes</em>.</p></li>
<li><p>Indexes can be utilized to speed up our queries.</p></li>
<li><p>We can track the speed of our queries by executing <code>.timer on</code> in <code>sqlite3</code>.</p></li>
<li><p>To understand how indexes can speed up our queries, run the following: <code>SELECT * FROM shows WHERE title = 'The Office';</code> Notice the time that displays after the query executes.</p></li>
<li><p>Then, we can create an index with the syntax <code>CREATE INDEX title_index ON shows (title);</code>. This tells <code>sqlite3</code> to create an index and perform some special under-the-hood optimization relating to this column <code>title</code>.</p></li>
<li><p>This will create a data structure called a <em>B Tree</em>, a data structure that looks similar to a binary tree. However, unlike a binary tree, there can be more than two child nodes.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/week_7/Week7Slide039.png" class="img-fluid figure-img"></p>
<figcaption>one node at the top from which come four children and below that there are three children coming from one of the nodes and two from another two from another and three from another</figcaption>
</figure>
</div></li>
<li><p>Further, we can create indexes as follows:</p>
<pre><code>CREATE INDEX name_index ON people (name);
CREATE INDEX person_index ON stars (person_id);
</code></pre></li>
<li><p>Running the query and you will notice that the query runs much more quickly!</p>
<pre><code>SELECT title FROM shows WHERE id IN 
    (SELECT show_id FROM stars WHERE person_id = 
        (SELECT id FROM people WHERE name = 'Steve Carell'));
</code></pre></li>
<li><p>Unfortunately, indexing all columns would result in utilizing more storage space. Therefore, there is a tradeoff for enhanced speed.</p></li>
</ul>
</section>
<section id="using-sql-in-python" class="level2">
<h2 class="anchored" data-anchor-id="using-sql-in-python">Using SQL in Python</h2>
<ul>
<li><p>To assist in working with SQL in this course, the CS50 Library can be utilized as follows in your code:</p>
<pre><code>from cs50 import SQL
</code></pre></li>
<li><p>Similar to previous uses of the CS50 Library, this library will assist with the complicated steps of utilizing SQL within your Python code.</p></li>
<li><p>You can read more about the CS50 Library’s SQL functionality in the <a href="https://cs50.readthedocs.io/libraries/cs50/python/#cs50.SQL">documentation</a>.</p></li>
<li><p>Using our new knowledge of SQL, we can now leverage Python alongside.</p></li>
<li><p>Modify your code for <code>favorites.py</code> as follows:</p>
<pre><code># Searches database popularity of a problem

from cs50 import SQL

# Open database
db = SQL("sqlite:///favorites.db")

# Prompt user for favorite
favorite = input("Favorite: ")

# Search for title
rows = db.execute("SELECT COUNT(*) AS n FROM favorites WHERE language = ?", favorite)

# Get first (and only) row
row = rows[0]

# Print popularity
print(row["n"])
</code></pre>
<p>Notice that <code>db = SQL("sqlite:///favorites.db")</code> provides Python the location of the database file. Then, the line that begins with <code>rows</code> executes SQL commands utilizing <code>db.execute</code>. Indeed, this command passes the syntax within the quotation marks to the <code>db.execute</code> function. We can issue any SQL command using this syntax. Further, notice that <code>rows</code> is returned as a list of dictionaries. In this case, there is only one result, one row, returned to the rows list as a dictionary.</p></li>
</ul>
</section>
<section id="race-conditions" class="level2">
<h2 class="anchored" data-anchor-id="race-conditions">Race Conditions</h2>
<ul>
<li>Utilization of SQL can sometimes result in some problems.</li>
<li>You can imagine a case where multiple users could be accessing the same database and executing commands at the same time.</li>
<li>This could result in glitches where code is interrupted by other people’s actions. This could result in a loss of data.</li>
<li>Built-in SQL features such as <code>BEGIN TRANSACTION</code>, <code>COMMIT</code>, and <code>ROLLBACK</code> help avoid some of these race condition problems.</li>
</ul>
</section>
<section id="sql-injection-attacks" class="level2">
<h2 class="anchored" data-anchor-id="sql-injection-attacks">SQL Injection Attacks</h2>
<ul>
<li><p>Now, still considering the code above, you might be wondering what the <code>?</code> question marks do above. One of the problems that can arise in real-world applications of SQL is what is called an <em>injection attack</em>. An injection attack is where a malicious actor could input malicious SQL code.</p></li>
<li><p>For example, consider a login screen as follows:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/week_7/Week7Slide051.png" class="img-fluid figure-img"></p>
<figcaption>harvard key login screen with username and password fields</figcaption>
</figure>
</div></li>
<li><p>Without the proper protections in our own code, a bad actor could run malicious code. Consider the following:</p>
<pre><code>rows = db.execute("SELECT COUNT(*) FROM users WHERE username = ? AND password = ?", username, password)
</code></pre>
<p>Notice that because the <code>?</code> is in place, validation can be run on <code>favorite</code> before it is blindly accepted by the query.</p></li>
<li><p>You never want to utilize formatted strings in queries as above or blindly trust the user’s input.</p></li>
<li><p>Utilizing the CS50 Library, the library will <em>sanitize</em> and remove any potentially malicious characters.</p></li>
</ul>
</section>
<section id="summing-up" class="level2">
<h2 class="anchored" data-anchor-id="summing-up">Summing Up</h2>
<p>In this lesson, you learned more syntax related to Python. Further, you learned how to integrate this knowledge with data in the form of flat-file and relational databases. Finally, you learned about <em>SQL</em>. Specifically, we discussed…</p>
<ul>
<li>Flat-file databases</li>
<li>Relational databases</li>
<li>SQL commands such as <code>SELECT</code>, <code>CREATE</code>, <code>INSERT</code>, <code>DELETE</code>, and <code>UPDATE</code>.</li>
<li>Primary and foreign keys</li>
<li><code>JOIN</code>s</li>
<li>Indexes</li>
<li>Using SQL in Python</li>
<li>Race conditions</li>
<li>SQL injection attacks</li>
</ul>
<p>See you next time!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/SQ4007-2025\.github\.io\/website\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 🐊 <a href="https://weharris.me">W. Edwin Harris</a></p>
</div>   
    <div class="nav-footer-center">
<p>📊 <a href="https://thestatisticslab.com">The Statistics Lab</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/SQ4007-2025/website/edit/main/notes/notes_8.md" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/SQ4007-2025/website/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>🚀 Built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>